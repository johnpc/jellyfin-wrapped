# Enable output filtering
AddOutputFilterByType SUBSTITUTE text/html

# Enable rewrite engine for SPA routing
RewriteEngine On

# If the requested resource doesn't exist as a file or directory,
# serve index.html instead (for client-side routing)
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} !-f
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} !-d
RewriteRule ^ /index.html [L]

# Define environment variable substitution
<Location />
    # Only perform substitution if environment variables are set
    <If "-n env('JELLYFIN_SERVER_URL') && -n env('JELLYFIN_API_KEY')">
        Substitute "s|<head>|<head><script>window.ENV = { JELLYFIN_SERVER_URL: '${JELLYFIN_SERVER_URL}', JELLYFIN_API_KEY: '${JELLYFIN_API_KEY}' };</script>|ni"
    </If>
</Location>
